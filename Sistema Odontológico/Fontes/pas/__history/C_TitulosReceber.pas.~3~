unit C_TitulosReceber;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Padrao, cxGraphics, cxControls,
  cxLookAndFeels, cxLookAndFeelPainters, cxContainer, cxEdit, dxSkinsCore,
  dxSkinsDefaultPainters, cxTextEdit, cxCurrencyEdit, JvToolEdit, Vcl.StdCtrls,
  Vcl.Mask, JvExMask, Vcl.Buttons, Data.DB, Data.Win.ADODB, JvComponentBase, Funcoes,
  JvEnterTab, Vcl.ComCtrls, Vcl.ExtCtrls;

type
  TfrmCadTitulosReceber = class(TfrmPadrao)
    qryAux: TADOQuery;
    btnSalvar: TSpeedButton;
    GroupBox1: TGroupBox;
    Label1: TLabel;
    Label2: TLabel;
    Label3: TLabel;
    Label4: TLabel;
    Label5: TLabel;
    Label6: TLabel;
    Label7: TLabel;
    Label8: TLabel;
    Label9: TLabel;
    Label10: TLabel;
    Label11: TLabel;
    EdtCodP: TJvComboEdit;
    EdtNome: TEdit;
    EdtHistorico: TEdit;
    EdtDocumento: TEdit;
    EdtDtConta: TJvDateEdit;
    EdtDtVencimento: TJvDateEdit;
    EdtNroNota: TEdit;
    EdtValor: TcxCurrencyEdit;
    EdtDesconto: TcxCurrencyEdit;
    EdtJuros: TcxCurrencyEdit;
    EdtDtPagamento: TJvDateEdit;
    EdtVlrPago: TcxCurrencyEdit;
    btnFechar: TSpeedButton;
    procedure btnFecharClick(Sender: TObject);
    procedure EdtCodPButtonClick(Sender: TObject);
    procedure EdtCodPExit(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  frmCadTitulosReceber: TfrmCadTitulosReceber;

implementation

{$R *.dfm}

uses P_Paciente, Main;

procedure TfrmCadTitulosReceber.btnFecharClick(Sender: TObject);
begin
  inherited;
  Close;
end;

procedure TfrmCadTitulosReceber.EdtCodPButtonClick(Sender: TObject);
begin
  inherited;
  Application.CreateForm(TfrmPesquisaPaciente, frmPesquisaPaciente);
  frmPesquisaPaciente.bFechar := True;
  frmPesquisaPaciente.ShowModal;
  EdtCodP.Text := frmMain.sCod;
  EdtCodPExit(Sender);
  FreeAndNil(frmPesquisaPaciente);
end;

procedure TfrmCadTitulosReceber.EdtCodPExit(Sender: TObject);
begin
  inherited;
  if EdtCodP.Text = '' then
  Begin
    EdtNome.Text := '';
    Exit;
  End;

  With qryAux do
  Begin
    Close;
    SQL.Clear;
    SQL.Add('SELECT NOME FROM PACIENTE');
    SQL.Add('WHERE ID_PACIENTE = :pCod');
    SQL.Add('AND ATIVO <> 0');
    Parameters.ParamByName('pCod').Value := StrToInt(EdtCodP.Text);
    Open;

    if Not Eof then
      Begin
        EdtNome.Text := FieldByName('NOME').AsString;
      End
    Else
      Begin
        EdtNome.Text := '';
        EdtCodP.Text := '';
      End;
  End;
end;

end.
